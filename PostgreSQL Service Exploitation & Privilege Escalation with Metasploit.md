# Postgres Vulnerability Exploitation & Privilage Escalation

Within this lab I will be finding scanning a system with nmap and OpenCas, and exploiting a vulnerability within a postgres service on a linux server. Upon getting into the system I will utilize metasploit for privilage escalation.

Tools utilized:
- Kali Linux
- Nmap / Zenmap
- OpenVas / Greenbone
- Metasploit
- Meterpreter
- IceWeasel

  
## Recon

First I wil be scanning the systems firewall for open ports that can be exploited. 

A simple Nmap command will do the trick. 'nmap 203.0.113.100 --system-dns'

<img width="887" height="601" alt="image" src="https://github.com/user-attachments/assets/3146ec6d-55eb-4de6-8dde-96917f73b3d5" />

This give me a useful starting point as to what port are open but we need to dig deeper to find more useful information.

Lets get into the zenmap gui to run more scans on the system.

Within zenmap I input the same IP address and run an intense scan of the system. When I swap to the ports section of the intense scan we once again see the postgres service.

<img width="884" height="800" alt="image" src="https://github.com/user-attachments/assets/503ec1c9-75c1-4786-aca4-db3494300de3" />

Back within the terminal I start the OpenVas tool to run more scans on the system.

With OpenVas running I go to the greenbone extension and once again scan the IP address.

<img width="917" height="706" alt="image" src="https://github.com/user-attachments/assets/edbdb63b-95bf-4471-8cdf-a3483a8a96ce" />

Within the greenbone scan results we see a wide range of vulnerabilities, but in this lab I will be focusing on the PostgreSQL weak password.

Clicking into the vulnerability report give us more detail on how we can exploit.

<img width="893" height="686" alt="image" src="https://github.com/user-attachments/assets/bacc645b-5afc-4721-8a3a-e2e0f6b693ed" />

The crucial vulnerability that greenbone identified is that we are able to log into this Postgre service with the password \"postgres\".

We know now that there is a weak possword on at least on account - from here we can begin out attack.


## Attacking the Target

Now that we have some idea of where to start, it is time to exploit the system and see what kind of damage we could cause.

Within a Kali Linux terminal we now need to utilize our findings to get into the Postgres server.

I start the metasploit tool and start probing the postgres service.

I enter the postgred login auxiliary model using - 'use auxiliary/scanner/postgres/postgres_login' within the metasploit tool.

From here a simple 'info' command give us all kind of valuable details for our attack.

<img width="1879" height="968" alt="image" src="https://github.com/user-attachments/assets/dc2db6c1-5423-41ca-a405-c19b04daef01" />

A big thing jumping out at me here is the USERNAME value field. WHich we can see is set to 'postgres'.

We will now use some brute force tools against the server in an attemp to get in. I run the following commands to get going:

- set RHOSTs 203.0.113.100 (setting the target IP)
- set USER_AS_PASS true (allowing the auxiliary module to try the username as the password)
- set STOP_ON_SUCCESS_TRUE (stopping the attack once we have correctly guessed a password)

Now its time to run the attack...

<img width="861" height="150" alt="image" src="https://github.com/user-attachments/assets/e80dfaf0-eda4-4073-9207-850bb31c14f6" />

It's a success! Now that we have credential we are in need of a payload to expoilt the service fully. I will be using metasploit to find one.

First I search for a pay load 'search postgres_payload', this will give me payload that match the specific postgres service.

<img width="1382" height="270" alt="image" src="https://github.com/user-attachments/assets/37f80bcb-fdae-4668-98ee-dcffa391b2ce" />

Now we can run the payload we found... we simply set the traget IP and the password we want to login with and we are good to go.

<img width="1425" height="241" alt="image" src="https://github.com/user-attachments/assets/8e40ed2b-2980-40ba-a9a4-6c2a9ca234a1" />

After intializing the exploit we can see Meterpreter at work. We are in.

Now I can use the command 'execute -f /bin/bash -i' to interact directly with the terminal on the victims machine.

Some more recon here will show us what user account we are using... in the terminal I enter a simple 'whoami'.

Let now test what kind of privilages we have... I enter 'cat /etc/shadow'. But sadly, I get denied.

<img width="838" height="84" alt="image" src="https://github.com/user-attachments/assets/555a7c88-b375-492b-9405-a32b9b8de525" />

I terminate the channel to the victims terminal and get back to meterpreter in an attempt to escalate priviliges.

I search for and execute a Linux local udev exploit within the terminal. Hoping that this will find us a new account with higher priviliges.

<img width="948" height="492" alt="image" src="https://github.com/user-attachments/assets/5add3589-0a2f-4a79-9fa7-f32f726fe706" />

I configure the options for the udev netlink and run the exploit.

<img width="1195" height="383" alt="image" src="https://github.com/user-attachments/assets/6f515ec2-9e86-42b6-bd04-1739b5d4bd3a" />

After the exploit was successful I reinitiate the connect to the victim machines terminal.

I run the 'whoami' again to determine what user account I am using...

<img width="521" height="156" alt="image" src="https://github.com/user-attachments/assets/a9c5916a-c93f-45e3-bfe9-c57a0fff4bce" />

We got into the root account!

Lets try reading that shadow file again... and then read the 'passwd' file as well.

We are now able to read all of the passwords for every user account on the server!

<img width="930" height="642" alt="image" src="https://github.com/user-attachments/assets/8f16f0c1-adbc-46bc-84ea-5c07c08831b2" />






